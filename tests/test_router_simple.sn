# Simplified router test to isolate crash

import "../src/http/router"

fn homeHandler(req: HttpRequest): HttpResponse =>
    return HttpResponse.ok().text("Home")

fn main(): void =>
    print("Testing router basics...\n")

    # Just create a router
    print("Creating router...\n")
    var router: Router = Router.new()
    print("Router created\n")

    # Add a route
    print("Adding route...\n")
    router.get("/", homeHandler)
    print("Route added\n")

    # Create a request
    print("Creating request...\n")
    var req: HttpRequest = HttpRequest.parse("GET / HTTP/1.1\r\n\r\n")
    print($"Request method: {req.method}\n")
    print($"Request path: {req.path}\n")

    # Handle the request
    print("Handling request...\n")
    var res: HttpResponse = router.handle(req)
    print($"Response status: {res.statusCode}\n")
    print($"Response body: {res.body}\n")

    print("Done!\n")
