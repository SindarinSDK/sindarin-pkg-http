# ==============================================================================
# tests/test_status.sn - Status Codes Test
# ==============================================================================
# Tests the HTTP status codes and helper functions.
# Compile: sn tests/test_status.sn -o tests/test_status
# Run: ./tests/test_status
# ==============================================================================

import "../src/http/status"

# Test counters must be declared before use
var testsPassed: int = 0
var testsFailed: int = 0

# Assert function must be declared before main
fn check(condition: bool, message: str): void =>
    if !condition =>
        print($"  FAIL: {message}\n")
        testsFailed++
    else =>
        testsPassed++

fn main(): void =>
    print("Testing HTTP Status Codes\n")
    print("=========================\n\n")

    # Test status code constants
    print("Testing status constants...\n")
    check(STATUS_OK == 200, "STATUS_OK should be 200")
    check(STATUS_CREATED == 201, "STATUS_CREATED should be 201")
    check(STATUS_NOT_FOUND == 404, "STATUS_NOT_FOUND should be 404")
    check(STATUS_INTERNAL_SERVER_ERROR == 500, "STATUS_INTERNAL_SERVER_ERROR should be 500")
    print("  Status constants OK\n")

    # Test statusText function
    print("Testing statusText()...\n")
    check(statusText(200) == "OK", "statusText(200) should be 'OK'")
    check(statusText(201) == "Created", "statusText(201) should be 'Created'")
    check(statusText(404) == "Not Found", "statusText(404) should be 'Not Found'")
    check(statusText(500) == "Internal Server Error", "statusText(500) should be 'Internal Server Error'")
    check(statusText(999) == "Unknown", "statusText(999) should be 'Unknown'")
    print("  statusText() OK\n")

    # Test category helpers
    print("Testing category helpers...\n")
    check(isInformational(100) == true, "100 should be informational")
    check(isInformational(199) == true, "199 should be informational")
    check(isInformational(200) == false, "200 should not be informational")

    check(isSuccess(200) == true, "200 should be success")
    check(isSuccess(299) == true, "299 should be success")
    check(isSuccess(300) == false, "300 should not be success")

    check(isRedirect(301) == true, "301 should be redirect")
    check(isRedirect(307) == true, "307 should be redirect")
    check(isRedirect(400) == false, "400 should not be redirect")

    check(isClientError(400) == true, "400 should be client error")
    check(isClientError(404) == true, "404 should be client error")
    check(isClientError(500) == false, "500 should not be client error")

    check(isServerError(500) == true, "500 should be server error")
    check(isServerError(503) == true, "503 should be server error")
    check(isServerError(400) == false, "400 should not be server error")

    check(isError(400) == true, "400 should be error")
    check(isError(500) == true, "500 should be error")
    check(isError(200) == false, "200 should not be error")
    print("  Category helpers OK\n")

    print($"\nTests passed: {testsPassed}, failed: {testsFailed}\n")
    if testsFailed == 0 =>
        print("All status tests passed!\n")
    else =>
        print("Some tests failed!\n")
